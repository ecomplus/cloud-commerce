---
import type { PageContext } from '@@sf/ssr-context';
import PitchBar, { type Props as PitchBarProps } from '~/components/PitchBar.vue';
import ShopHeader, { type Props as ShopHeaderProps } from '~/components/ShopHeader.vue';

export interface Props {
  pageContext: PageContext;
  logoHeading?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | null;
}

const {
  pageContext: {
    isHomepage,
    apiState,
    cms,
  },
} = Astro.props as Props;
const cmsHeader = await cms('header');
const pitchBar: PitchBarProps = { slides: [] };
if (cmsHeader.pitch_bar) {
  pitchBar.slides = cmsHeader.pitch_bar;
}
const shopHeader: ShopHeaderProps = {
  categories: apiState.categories,
};
const LogoHeading = Astro.props.logoHeading || (isHomepage ? 'h1' : 'h2');
---

<Fragment>
  <slot name="pitch-bar">
    {pitchBar.slides.length > 1 && <PitchBar {...pitchBar} client:idle />}
    {pitchBar.slides.length === 1 && <PitchBar {...pitchBar} />}
  </slot>
  <slot name="sticky-cmsHeader">
    <ShopHeader {...shopHeader} client:load>
      <Fragment slot="logo">
        <slot name="logo">
          <a href="/">
            <LogoHeading>
              <slot name="logo-picture" />
            </LogoHeading>
          </a>
        </slot>
      </Fragment>
    </ShopHeader>
  </slot>
</Fragment>

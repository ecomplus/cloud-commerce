---
import type { Categories } from '@cloudcommerce/api/types';
import type CmsHeader from '@@sf/types/cms-header';
import type CmsContacts from '@@sf/types/cms-contacts';
import type { PageContext } from '@@sf/ssr-context';
import Picture from '@@sf/ssr/Picture.astro';
import PitchBar, { Props as PitchBarProps } from '@@sf/components/PitchBar.vue';
import ShopHeader from '@@sf/components/ShopHeader.vue';

export interface Props {
  pageContext: PageContext;
  logoHeading?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | null;
}

const {
  pageContext: {
    isHomepage,
    apiState,
    settings,
    cms,
  },
} = Astro.props as Props;
const header = cms('header') as CmsHeader &
  { marketing_stripe?: { text: string, link: string }, logo?: string };
const pitchBar: PitchBarProps = { slides: [] };
if (header.pitch_bar) {
  pitchBar.slides = header.pitch_bar;
} else if (header.marketing_stripe) {
  pitchBar.slides = [{
    href: header.marketing_stripe.link,
    html: header.marketing_stripe.text,
  }];
}
const logoSrc = header.logo || settings.logo;
const LogoHeading = Astro.props.logoHeading || (isHomepage ? 'h1' : 'h2');
---

<Fragment>
  <slot name="pitch-bar">
    {pitchBar.slides.length > 1 && <PitchBar {...pitchBar} client:idle />}
    {pitchBar.slides.length === 1 && <PitchBar {...pitchBar} />}
  </slot>
  <slot name="sticky-header">
    <ShopHeader client:load>
      <Fragment slot="logo">
        <slot name="logo">
          <a href="/">
            <LogoHeading>
              <Picture
                src={logoSrc}
                alt={settings.name}
                widths={[300]}
                sizes="150px"
                fetchpriority="high"
                class="hover:drop-shadow-sm"
              />
            </LogoHeading>
          </a>
        </slot>
      </Fragment>
    </ShopHeader>
  </slot>
</Fragment>

<style is:global>
/*
[data-pitch-bar] {
  @apply bg-slate-300;
}
[data-pitch-bar-controls] > * {
  @apply bg-slate-300;
}
*/
</style>

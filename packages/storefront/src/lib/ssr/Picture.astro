---
import { Picture } from '@astrojs/image/components';
import { tryImageSize, getAspectRatio } from '@@sf/ssr/image';

type PictureProps = Parameters<typeof Picture>[0];

export type Props = Omit<PictureProps, 'aspectRatio'> & {
  aspectRatio?: PictureProps['aspectRatio'],
  fetchpriority?: 'high' | 'low' | 'auto',
};

const props = Astro.props as PictureProps;
if (
  (!props.width || !props.height)
  && !props.aspectRatio
  && typeof props.src === 'string'
) {
  const { width, height } = tryImageSize(props.src);
  if (height) {
    props.aspectRatio = getAspectRatio({ width, height });
    props.width = width;
    props.height = height;
  }
}
---

<Picture {...props} />

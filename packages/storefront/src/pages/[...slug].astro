---
import ViewWildcard from '../lib/views/[...slug].astro';
import loadPageContext, { PageContext } from '../lib/ssr-context';

if (String(Astro.params.slug).endsWith('.css.map')) {
  return new Response(null, { status: 404 });
}

let pageContext: PageContext;
let loadError: any;
try {
  pageContext = await loadPageContext(Astro);
} catch (err) {
  if (err.astroResponse) {
    return err.astroResponse;
  }
  loadError = err;
}
---

{pageContext && <ViewWildcard pageContext={pageContext} />}
{loadError && <Fragment set:html={loadError.responseHTML} />}
